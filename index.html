<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>ƒê·∫øm b√∫ng tai ‚Äì C·ªù c√° ng·ª±a</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root {
      --bg: #020617;
      --bg-soft: #0b1220;
      --card: #020617;
      --card-soft: #020617;
      --border: #1f2937;
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --radius-lg: 18px;
      --radius-md: 12px;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background:
        radial-gradient(circle at top, rgba(56,189,248,0.16), transparent 55%),
        radial-gradient(circle at bottom, rgba(74,222,128,0.08), transparent 55%),
        var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    .app-wrapper {
      max-width: 960px;
      margin: 0 auto;
      padding: 16px 14px 40px;
    }

    .page-header {
      position: sticky;
      top: 0;
      z-index: 10;
      margin: -16px -14px 16px;
      padding: 12px 16px 10px;
      background: linear-gradient(to bottom, rgba(15,23,42,0.96), rgba(15,23,42,0.92));
      backdrop-filter: blur(18px);
      border-bottom: 1px solid rgba(148,163,184,0.25);
    }

    .title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 18px;
      font-weight: 600;
    }
    .title-pill {
      padding: 2px 8px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.45);
      color: var(--text-muted);
    }
    .subtitle {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    h2 {
      margin: 0 0 10px;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.16), transparent 55%), 
                  var(--card);
      border-radius: var(--radius-lg);
      padding: 14px 14px 12px;
      border: 1px solid rgba(148,163,184,0.4);
      box-shadow: 0 18px 55px rgba(15,23,42,0.7);
      margin-bottom: 14px;
    }
    .card-soft {
      background: var(--card-soft);
      border-radius: var(--radius-lg);
      padding: 12px 12px 10px;
      border: 1px solid rgba(31,41,55,0.85);
      margin-bottom: 12px;
    }

    label {
      font-size: 12px;
      font-weight: 500;
      display: block;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    input[type="text"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.95);
      color: var(--text);
      font-size: 13px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease,
        background 0.15s ease;
    }
    input::placeholder {
      color: rgba(148,163,184,0.5);
    }
    input:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56,189,248,0.4);
      background: #020617;
    }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
      margin: 6px 0 0;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      font-size: 13px;
      cursor: pointer;
      font-weight: 500;
      background: linear-gradient(to right, #38bdf8, #22c55e);
      color: #0b1120;
      letter-spacing: 0.02em;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      box-shadow: 0 10px 32px rgba(34,197,94,0.3);
      border: 1px solid rgba(8,47,73,0.7);
      flex: 1 1 130px;
    }
    .btn span.icon {
      font-size: 15px;
    }
    .btn-secondary {
      background: rgba(15,23,42,0.95);
      color: var(--text-muted);
      box-shadow: none;
      border: 1px solid rgba(55,65,81,0.9);
      flex: 0 0 auto;
    }
    .btn-danger {
      background: radial-gradient(circle at top left, rgba(248,113,113,0.16), transparent 60%),
                  #7f1d1d;
      color: #fee2e2;
      box-shadow: 0 10px 30px rgba(248,113,113,0.35);
      border-color: rgba(127,29,29,0.9);
    }
    .btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      box-shadow: none;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .col {
      flex: 1 1 140px;
      min-width: min(100%, 180px);
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
      color: var(--text-muted);
    }
    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .table-wrapper {
      margin-top: 8px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(31,41,55,0.9);
      background: radial-gradient(circle at top left, rgba(15,23,42,0.98), rgba(15,23,42,0.98));
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 420px;
    }

    th, td {
      padding: 7px 8px;
      text-align: center;
      font-size: 12px;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      color: var(--text-muted);
      white-space: nowrap;
    }
    th {
      background: rgba(15,23,42,0.96);
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    tbody tr:nth-child(even) td {
      background: rgba(15,23,42,0.92);
    }
    tbody tr:nth-child(odd) td {
      background: rgba(15,23,42,0.98);
    }
    td.text-left {
      text-align: left;
    }

    .badge-color {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid rgba(55,65,81,0.9);
      background: rgba(15,23,42,0.95);
      color: var(--text-muted);
    }
    .dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
      display: inline-block;
    }
    .dot-red { background: #ef4444; }
    .dot-green { background: #22c55e; }
    .dot-blue { background: #3b82f6; }
    .dot-yellow { background: #eab308; }

    .section-grid {
      display: grid;
      grid-template-columns: minmax(0,1fr);
      gap: 10px;
      margin-top: 6px;
    }

    @media (min-width: 720px) {
      .card, .card-soft {
        padding: 14px 16px 14px;
      }
      .section-grid {
        grid-template-columns: repeat(3, minmax(0,1fr));
      }
    }

    hr.divider {
      border: none;
      border-top: 1px dashed rgba(55,65,81,0.9);
      margin: 12px 0;
    }
  </style>
</head>
<body>
  <div class="page-header">
    <div class="title">
      <span>ƒê·∫øm b√∫ng tai ‚Äì C·ªù c√° ng·ª±a</span>
      <span class="title-pill">4 ng∆∞·ªùi ¬∑ Mobile first</span>
    </div>
    <div class="subtitle">
      Nh·∫≠p ng∆∞·ªùi ch∆°i, b·∫•m c√°c n√∫t theo lu·∫≠t, h·ªá th·ªëng t·ª± t√≠nh ai b√∫ng ai v√† t·ªïng s·ªë l·∫ßn b·ªã b√∫ng.
    </div>
  </div>

  <div class="app-wrapper">
    <!-- C·∫•u h√¨nh ng∆∞·ªùi ch∆°i -->
    <div class="card">
      <h2>C·∫•u h√¨nh ng∆∞·ªùi ch∆°i</h2>
      <div class="row">
        <div class="col">
          <label for="name1">Ng∆∞·ªùi ch∆°i 1</label>
          <input type="text" id="name1" placeholder="V≈©, Huy·ªÅn, ‚Ä¶" />
        </div>
        <div class="col">
          <label for="color1">M√†u</label>
          <select id="color1">
            <option value="red">ƒê·ªè</option>
            <option value="green">Xanh l√°</option>
            <option value="blue">Xanh d∆∞∆°ng</option>
            <option value="yellow">V√†ng</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top: 6px;">
        <div class="col">
          <label for="name2">Ng∆∞·ªùi ch∆°i 2</label>
          <input type="text" id="name2" placeholder="T√™n ng∆∞·ªùi ch∆°i 2" />
        </div>
        <div class="col">
          <label for="color2">M√†u</label>
          <select id="color2">
            <option value="red">ƒê·ªè</option>
            <option value="green">Xanh l√°</option>
            <option value="blue">Xanh d∆∞∆°ng</option>
            <option value="yellow">V√†ng</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top: 6px;">
        <div class="col">
          <label for="name3">Ng∆∞·ªùi ch∆°i 3</label>
          <input type="text" id="name3" placeholder="T√™n ng∆∞·ªùi ch∆°i 3" />
        </div>
        <div class="col">
          <label for="color3">M√†u</label>
          <select id="color3">
            <option value="red">ƒê·ªè</option>
            <option value="green">Xanh l√°</option>
            <option value="blue">Xanh d∆∞∆°ng</option>
            <option value="yellow">V√†ng</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top: 6px;">
        <div class="col">
          <label for="name4">Ng∆∞·ªùi ch∆°i 4</label>
          <input type="text" id="name4" placeholder="T√™n ng∆∞·ªùi ch∆°i 4" />
        </div>
        <div class="col">
          <label for="color4">M√†u</label>
          <select id="color4">
            <option value="red">ƒê·ªè</option>
            <option value="green">Xanh l√°</option>
            <option value="blue">Xanh d∆∞∆°ng</option>
            <option value="yellow">V√†ng</option>
          </select>
        </div>
      </div>

      <p class="hint">
        M·ªói ng∆∞·ªùi n√™n c√≥ 1 m√†u ri√™ng cho d·ªÖ nh√¨n (nh∆∞ng kh√¥ng b·∫Øt bu·ªôc).
      </p>

      <div class="btn-row">
        <button class="btn" id="initGameBtn">
          <span class="icon">üéÆ</span>
          <span>Kh·ªüi t·∫°o / C·∫≠p nh·∫≠t ng∆∞·ªùi ch∆°i</span>
        </button>
        <button class="btn btn-danger" id="resetCountsBtn" disabled>
          <span class="icon">‚ôªÔ∏è</span>
          <span>Reset to√†n b·ªô</span>
        </button>
      </div>
    </div>

    <!-- Khu v·ª±c ch∆°i -->
    <div id="gameArea" style="display:none;">
      <div class="card-soft">
        <div class="section-title">T·ªïng s·ªë l·∫ßn b·ªã b√∫ng tai</div>
        <p class="hint">
          ƒê√£ c·∫•n tr·ª´ qua l·∫°i. V√≠ d·ª•: V≈© b√∫ng Huy·ªÅn 3, Huy·ªÅn b√∫ng l·∫°i V≈© 1 ‚áí hi·ªÉn th·ªã V≈©‚ÜíHuy·ªÅn = 2, Huy·ªÅn‚ÜíV≈© = 0.
        </p>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th class="text-left">Ng∆∞·ªùi ch∆°i</th>
                <th>M√†u</th>
                <th>T·ªïng l·∫ßn b·ªã b√∫ng</th>
              </tr>
            </thead>
            <tbody id="scoreBody"></tbody>
          </table>
        </div>
      </div>

      <div class="card-soft">
        <div class="section-title">Ma tr·∫≠n ‚Äúai b√∫ng tai ai‚Äù</div>
        <p class="hint">
          H√†ng l√† ng∆∞·ªùi <strong>b√∫ng</strong>, c·ªôt l√† ng∆∞·ªùi <strong>b·ªã b√∫ng</strong> (ƒë√£ c·∫•n tr·ª´ hai chi·ªÅu).
        </p>
        <div class="table-wrapper">
          <table id="matrixTable">
            <thead id="matrixHead"></thead>
            <tbody id="matrixBody"></tbody>
          </table>
        </div>
      </div>

      <div class="card-soft">
        <div class="section-title">C√°c thao t√°c theo lu·∫≠t</div>
        <p class="hint">
          M·ªói thao t√°c s·∫Ω t·ª± c·ªông (v√† c·∫•n tr·ª´) v√†o ma tr·∫≠n ng∆∞·ªùi b√∫ng ‚Üí ng∆∞·ªùi b·ªã b√∫ng.
        </p>

        <div class="section-grid">
          <!-- Qu√¢n v·ªÅ chu·ªìng s·ªë 6 ƒë·∫ßu ti√™n -->
          <div>
            <div class="pill">
              <span class="pill-dot"></span>
              <span>Lu·∫≠t 1 ‚Äì V·ªÅ chu·ªìng s·ªë 6</span>
            </div>
            <p class="hint" style="margin-top:4px;">
              Ai v·ªÅ chu·ªìng s·ªë 6 ƒë·∫ßu ti√™n th√¨ 3 ng∆∞·ªùi c√≤n l·∫°i m·ªói ng∆∞·ªùi b·ªã +2 l·∫ßn b√∫ng tai t·ª´ ng∆∞·ªùi ƒë√≥.
            </p>
            <label for="firstHomeSelect">Ng∆∞·ªùi v·ªÅ chu·ªìng s·ªë 6 tr∆∞·ªõc:</label>
            <select id="firstHomeSelect"></select>
            <button class="btn btn-secondary" id="firstHomeBtn" style="width:100%;margin-top:6px;">
              √Åp d·ª•ng lu·∫≠t 1
            </button>
          </div>

          <!-- ƒê√° trong chu·ªìng ch·ªß nh√† -->
          <div>
            <div class="pill">
              <span class="pill-dot"></span>
              <span>Lu·∫≠t 2 ‚Äì ƒê√° trong chu·ªìng</span>
            </div>
            <p class="hint" style="margin-top:4px;">
              ƒê·ª©ng trong chu·ªìng c·ªßa ng∆∞·ªùi kh√°c m√† b·ªã ch·ªß chu·ªìng ƒë√° ‚áí b·ªã +2 l·∫ßn b√∫ng t·ª´ ch·ªß chu·ªìng.
            </p>
            <label>Ng∆∞·ªùi ƒë√° (ch·ªß chu·ªìng):</label>
            <select id="kickHomeAttacker"></select>

            <label style="margin-top:6px;">Ng∆∞·ªùi b·ªã ƒë√°:</label>
            <select id="kickHomeVictim"></select>

            <button class="btn btn-secondary" id="kickHomeBtn" style="width:100%;margin-top:6px;">
              √Åp d·ª•ng lu·∫≠t 2 (+2)
            </button>
          </div>

          <!-- ƒê√° ngo√†i chu·ªìng -->
          <div>
            <div class="pill">
              <span class="pill-dot"></span>
              <span>Lu·∫≠t 3 ‚Äì ƒê√° ngo√†i chu·ªìng</span>
            </div>
            <p class="hint" style="margin-top:4px;">
              Ai b·ªã ƒë√° ngo√†i chu·ªìng ‚áí b·ªã +1 l·∫ßn b√∫ng tai t·ª´ ng∆∞·ªùi ƒë√°.
            </p>
            <label>Ng∆∞·ªùi ƒë√°:</label>
            <select id="kickNormalAttacker"></select>

            <label style="margin-top:6px;">Ng∆∞·ªùi b·ªã ƒë√°:</label>
            <select id="kickNormalVictim"></select>

            <button class="btn btn-secondary" id="kickNormalBtn" style="width:100%;margin-top:6px;">
              √Åp d·ª•ng lu·∫≠t 3 (+1)
            </button>
          </div>
        </div>

        <hr class="divider" />

        <!-- Xong tr·∫≠n -->
        <div>
          <div class="pill">
            <span class="pill-dot"></span>
            <span>Lu·∫≠t 4 ‚Äì Xong tr·∫≠n, x·∫øp h·∫°ng</span>
          </div>
          <p class="hint" style="margin-top:4px;">
            Ch·ªçn th·ª© h·∫°ng cu·ªëi tr·∫≠n. Ng∆∞·ªùi <strong>nh·∫•t</strong> s·∫Ω b√∫ng ng∆∞·ªùi
            <strong>nh√¨</strong> +3, ng∆∞·ªùi <strong>ba</strong> +4, ng∆∞·ªùi
            <strong>b·ªën</strong> +5 (v·∫´n c·∫•n tr·ª´ hai chi·ªÅu).
          </p>
          <div class="row">
            <div class="col">
              <label for="rank1Select">H·∫°ng 1 (Nh·∫•t):</label>
              <select id="rank1Select"></select>
            </div>
            <div class="col">
              <label for="rank2Select">H·∫°ng 2 (Nh√¨):</label>
              <select id="rank2Select"></select>
            </div>
          </div>
          <div class="row" style="margin-top:6px;">
            <div class="col">
              <label for="rank3Select">H·∫°ng 3 (Ba):</label>
              <select id="rank3Select"></select>
            </div>
            <div class="col">
              <label for="rank4Select">H·∫°ng 4 (B·ªën):</label>
              <select id="rank4Select"></select>
            </div>
          </div>
          <button class="btn" id="finishMatchBtn" style="width:100%;margin-top:8px;">
            <span class="icon">üèÅ</span>
            <span>Xong tr·∫≠n ‚Äì √Åp d·ª•ng th∆∞·ªüng ph·∫°t</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const players = [];
    let flickMatrix = [];

    function colorClass(color) {
      switch (color) {
        case "red": return "dot-red";
        case "green": return "dot-green";
        case "blue": return "dot-blue";
        case "yellow": return "dot-yellow";
        default: return "";
      }
    }

    function colorLabel(color) {
      switch (color) {
        case "red": return "ƒê·ªè";
        case "green": return "Xanh l√°";
        case "blue": return "Xanh d∆∞∆°ng";
        case "yellow": return "V√†ng";
        default: return color;
      }
    }

    function initMatrix() {
      flickMatrix = [];
      for (let i = 0; i < 4; i++) {
        const row = [];
        for (let j = 0; j < 4; j++) row.push(0);
        flickMatrix.push(row);
      }
    }

    // C·ªông b√∫ng c√≥ c·∫•n tr·ª´ ng∆∞·ª£c chi·ªÅu
    function addFlick(attackerIndex, victimIndex, amount) {
      if (attackerIndex === victimIndex || amount <= 0) return;

      let remain = amount;
      const opp = flickMatrix[victimIndex][attackerIndex];

      if (opp >= remain) {
        flickMatrix[victimIndex][attackerIndex] -= remain;
        remain = 0;
      } else {
        remain -= opp;
        flickMatrix[victimIndex][attackerIndex] = 0;
      }

      if (remain > 0) {
        flickMatrix[attackerIndex][victimIndex] += remain;
      }
    }

    function initPlayers() {
      players.length = 0;

      const names = [
        document.getElementById("name1").value.trim() || "Ng∆∞·ªùi ch∆°i 1",
        document.getElementById("name2").value.trim() || "Ng∆∞·ªùi ch∆°i 2",
        document.getElementById("name3").value.trim() || "Ng∆∞·ªùi ch∆°i 3",
        document.getElementById("name4").value.trim() || "Ng∆∞·ªùi ch∆°i 4",
      ];
      const colors = [
        document.getElementById("color1").value,
        document.getElementById("color2").value,
        document.getElementById("color3").value,
        document.getElementById("color4").value,
      ];

      const colorSet = new Set(colors);
      if (colorSet.size < colors.length) {
        alert("L∆∞u √Ω: C√≥ √≠t nh·∫•t hai ng∆∞·ªùi tr√πng m√†u. N·∫øu mu·ªën ƒë√∫ng lu·∫≠t c·ªù c√° ng·ª±a, h√£y ch·ªânh l·∫°i cho m·ªói ng∆∞·ªùi m·ªôt m√†u kh√°c nhau.");
      }

      for (let i = 0; i < 4; i++) {
        players.push({ id: i + 1, name: names[i], color: colors[i] });
      }

      initMatrix();
      updateAllViews();
      populateSelects();
      document.getElementById("gameArea").style.display = "block";
      document.getElementById("resetCountsBtn").disabled = false;
    }

    function getTotalsPerVictim() {
      const totals = [0, 0, 0, 0];
      for (let a = 0; a < 4; a++) {
        for (let v = 0; v < 4; v++) {
          totals[v] += flickMatrix[a][v];
        }
      }
      return totals;
    }

    function updateScoreboard() {
      const tbody = document.getElementById("scoreBody");
      tbody.innerHTML = "";
      const totals = getTotalsPerVictim();

      players.forEach((p, index) => {
        const tr = document.createElement("tr");

        const tdIndex = document.createElement("td");
        tdIndex.textContent = index + 1;

        const tdName = document.createElement("td");
        tdName.textContent = p.name;
        tdName.className = "text-left";

        const tdColor = document.createElement("td");
        const span = document.createElement("span");
        span.className = "badge-color";
        span.innerHTML =
          '<span class="dot ' + colorClass(p.color) + '"></span>' +
          "<span>" + colorLabel(p.color) + "</span>";
        tdColor.appendChild(span);

        const tdTotal = document.createElement("td");
        tdTotal.textContent = totals[index];

        tr.appendChild(tdIndex);
        tr.appendChild(tdName);
        tr.appendChild(tdColor);
        tr.appendChild(tdTotal);
        tbody.appendChild(tr);
      });
    }

    function updateMatrixTable() {
      const head = document.getElementById("matrixHead");
      const body = document.getElementById("matrixBody");

      head.innerHTML = "";
      body.innerHTML = "";

      const headRow = document.createElement("tr");
      const corner = document.createElement("th");
      corner.textContent = "B√∫ng \\ B·ªã b√∫ng";
      headRow.appendChild(corner);

      players.forEach((p) => {
        const th = document.createElement("th");
        th.textContent = p.name;
        headRow.appendChild(th);
      });
      head.appendChild(headRow);

      players.forEach((attacker, i) => {
        const tr = document.createElement("tr");
        const thName = document.createElement("th");
        thName.textContent = attacker.name;
        tr.appendChild(thName);

        players.forEach((victim, j) => {
          const td = document.createElement("td");
          if (i === j) {
            td.textContent = "-";
            td.style.color = "#4b5563";
          } else {
            td.textContent = flickMatrix[i][j];
          }
          tr.appendChild(td);
        });

        body.appendChild(tr);
      });
    }

    function updateAllViews() {
      updateScoreboard();
      updateMatrixTable();
    }

    function populateSelect(id) {
      const sel = document.getElementById(id);
      if (!sel) return;
      sel.innerHTML = "";
      players.forEach((p) => {
        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = p.name + " (" + colorLabel(p.color) + ")";
        sel.appendChild(opt);
      });
    }

    function populateSelects() {
      populateSelect("firstHomeSelect");
      populateSelect("kickHomeAttacker");
      populateSelect("kickHomeVictim");
      populateSelect("kickNormalAttacker");
      populateSelect("kickNormalVictim");
      populateSelect("rank1Select");
      populateSelect("rank2Select");
      populateSelect("rank3Select");
      populateSelect("rank4Select");
    }

    function handleFirstHome() {
      const select = document.getElementById("firstHomeSelect");
      const id = parseInt(select.value, 10);
      if (!id) return;

      const attackerIndex = id - 1;
      for (let v = 0; v < 4; v++) {
        if (v !== attackerIndex) addFlick(attackerIndex, v, 2);
      }
      updateAllViews();
    }

    function handleKick(isHome) {
      const attackerSelect = isHome
        ? document.getElementById("kickHomeAttacker")
        : document.getElementById("kickNormalAttacker");
      const victimSelect = isHome
        ? document.getElementById("kickHomeVictim")
        : document.getElementById("kickNormalVictim");

      const attackerId = parseInt(attackerSelect.value, 10);
      const victimId = parseInt(victimSelect.value, 10);
      if (!attackerId || !victimId) return;
      if (attackerId === victimId) {
        alert("Ng∆∞·ªùi ƒë√° v√† ng∆∞·ªùi b·ªã ƒë√° kh√¥ng th·ªÉ l√† c√πng m·ªôt ng∆∞·ªùi.");
        return;
      }

      const attackerIndex = attackerId - 1;
      const victimIndex = victimId - 1;
      addFlick(attackerIndex, victimIndex, isHome ? 2 : 1);
      updateAllViews();
    }

    function handleFinishMatch() {
      const r1 = parseInt(document.getElementById("rank1Select").value, 10);
      const r2 = parseInt(document.getElementById("rank2Select").value, 10);
      const r3 = parseInt(document.getElementById("rank3Select").value, 10);
      const r4 = parseInt(document.getElementById("rank4Select").value, 10);

      const ids = [r1, r2, r3, r4];
      if (ids.some(id => !id)) {
        alert("Vui l√≤ng ch·ªçn ƒë·ªß 4 v·ªã tr√≠ x·∫øp h·∫°ng.");
        return;
      }
      const uniq = new Set(ids);
      if (uniq.size < 4) {
        alert("M·ªói ng∆∞·ªùi ch·ªâ ƒë∆∞·ª£c ƒë·ª©ng ƒë√∫ng 1 h·∫°ng. Ki·ªÉm tra l·∫°i.");
        return;
      }

      const first  = r1 - 1;
      const second = r2 - 1;
      const third  = r3 - 1;
      const fourth = r4 - 1;

      addFlick(first, second, 3);
      addFlick(first, third, 4);
      addFlick(first, fourth, 5);

      updateAllViews();
    }

    function resetCounts() {
      initMatrix();
      updateAllViews();
    }

    document.getElementById("initGameBtn").addEventListener("click", initPlayers);
    document.getElementById("firstHomeBtn").addEventListener("click", handleFirstHome);
    document.getElementById("kickHomeBtn").addEventListener("click", () => handleKick(true));
    document.getElementById("kickNormalBtn").addEventListener("click", () => handleKick(false));
    document.getElementById("resetCountsBtn").addEventListener("click", resetCounts);
    document.getElementById("finishMatchBtn").addEventListener("click", handleFinishMatch);
  </script>
</body>
</html>
